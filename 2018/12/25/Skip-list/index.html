<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>Skip_list | Sanstyle</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Because the binary search depends on the characteristics of array random access, it can only be implemented with arrays. If the data is stored in a linked list, is it really im">
<meta name="keywords" content="Algorithms">
<meta property="og:type" content="article">
<meta property="og:title" content="Skip_list">
<meta property="og:url" content="http://www.sunstady.xyz/2018/12/25/Skip-list/index.html">
<meta property="og:site_name" content="Sanstyle">
<meta property="og:description" content="&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Because the binary search depends on the characteristics of array random access, it can only be implemented with arrays. If the data is stored in a linked list, is it really im">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://github.com/sunstady/hexoFirst/blob/master/Skip_list/1.jpg?raw=true">
<meta property="og:image" content="https://github.com/sunstady/hexoFirst/blob/master/Skip_list/2.jpg?raw=true">
<meta property="og:image" content="https://github.com/sunstady/hexoFirst/blob/master/Skip_list/3.jpg?raw=true">
<meta property="og:image" content="https://github.com/sunstady/hexoFirst/blob/master/Skip_list/4.jpg?raw=true">
<meta property="og:image" content="https://github.com/sunstady/hexoFirst/blob/master/Skip_list/5.jpg?raw=true">
<meta property="og:image" content="https://github.com/sunstady/hexoFirst/blob/master/Skip_list/6.jpg?raw=true">
<meta property="og:image" content="https://github.com/sunstady/hexoFirst/blob/master/Skip_list/7.jpg?raw=true">
<meta property="og:image" content="https://github.com/sunstady/hexoFirst/blob/master/Skip_list/8.jpg?raw=true">
<meta property="og:image" content="https://github.com/sunstady/hexoFirst/blob/master/Skip_list/9.jpg?raw=true">
<meta property="og:image" content="https://github.com/sunstady/hexoFirst/blob/master/Skip_list/10.jpg?raw=true">
<meta property="og:updated_time" content="2018-12-25T02:56:41.723Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Skip_list">
<meta name="twitter:description" content="&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Because the binary search depends on the characteristics of array random access, it can only be implemented with arrays. If the data is stored in a linked list, is it really im">
<meta name="twitter:image" content="https://github.com/sunstady/hexoFirst/blob/master/Skip_list/1.jpg?raw=true">
  
    <link rel="alternate" href="/atom.xml" title="Sanstyle" type="application/atom+xml">
  
  
    <link rel="icon" href="https://github.com/sunstady/hexoFirst/blob/master/blog_bg/1.png?raw=true">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/plugin/bganimation/bg.css">
  

</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <div class="outer">
        <div class="widget-wrap mobile-header">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <img class="avatar" src="https://github.com/sunstady/hexo/blob/master/images/2017.jpg?raw=true">
    <h2 class="author">时三</h2>
    <h3 class="description">我善良,并不代表我不邪恶.</h3>
    <div class="count-box">
      <a href="/archives"><div><strong>3</strong><br>文章</div></a>
      <a href="/categories"><div><strong>2</strong><br>分类</div></a>
      <a href="/tags"><div><strong>2</strong><br>标签</div></a>
    </div>
    <ul class="blog-link">
     
          <a href="/" title="Home">
            <li>主页</li>
          </a>
        
          <a href="/archives" title="Archives">
            <li>归档</li>
          </a>
        
          <a href="/categories" title="Categories">
            <li>分类</li>
          </a>
        
          <a href="/tags" title="Tags">
            <li>标签</li>
          </a>
        
          <a href="/about" title="关于">
            <li>关于</li>
          </a>
        
    </ul>
  </div>
</div>

        <section id="main"><article id="post-Skip-list" class="wow slideInRight article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/12/25/Skip-list/" class="article-date">
  <time class="post-time" datetime="2018-12-24T16:47:59.000Z" itemprop="datePublished">
    <span class="post-month">12月</span><br>
    <span class="post-day">25</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Skip_list
    </h1>
  

        <div>
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/Algorithms/">Algorithms</a>
  </div>

          
              
  &nbsp; | &nbsp;
  <div class="view-box">
    <span id="/2018/12/25/Skip-list/" class="leancloud_visitors" data-flag-title="Skip_list">
      &nbsp;阅读次数<span class="leancloud-visitors-count"></span>
    </span>
  </div>


          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&nbsp;&nbsp;&nbsp;&nbsp;Because the <code>binary search</code> depends on the characteristics of array random access, it can only be implemented with <code>arrays</code>. If the data is stored in a <code>linked list</code>, is it really impossible to use the <code>binary search</code> algorithm?</p>
<a id="more"></a>
<p>&nbsp;&nbsp;&nbsp;&nbsp;In fact, we only need to modify the linked list to support a search algorithm similar to <code>&quot;binary search&quot;</code>. We call the data structure after the transformation “Skip list”(跳表).</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;It is a dynamic data structure with excellent performance in all aspects. It can support fast insertion, deletion, and search operations. It is not complicated to write, and can even replace Red-black trees.</p>
<h2 id="How-to-understand-Skip-list"><a href="#How-to-understand-Skip-list" class="headerlink" title="How to understand Skip list"></a>How to understand Skip list</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;For a <code>single linked list</code>, even if the data stored in the <code>linked list</code> is ordered, if we want to find a certain data in it, we can only traverse the <code>linked list</code> from beginning to end. This way the search efficiency will be very low, the <code>time complexity</code> will be very high, it is O(n).<br><img src="https://github.com/sunstady/hexoFirst/blob/master/Skip_list/1.jpg?raw=true" alt="1"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;The two nodes extract a node to the upper level, and we refer to the extracted level as the index or index layer. The down in the figure represents the down pointer, pointing to the next level node.<br><img src="https://github.com/sunstady/hexoFirst/blob/master/Skip_list/2.jpg?raw=true" alt="2"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;If we are looking for a node now, say 16 . We can traverse the index layer first. When traversing to the node with a value of 13 in the index layer, we find that the next node is 17, and the node 16 to be found must be between the two nodes. Then we descend to the original linked list layer by the down pointer of the index layer node and continue traversing. At this time, we only need to traverse 2 nodes, we can find the node with the value equal to 16. Thus, if you want to find 16 and need to traverse 10 nodes, you only need to traverse 7 nodes.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;From this example, we can see that after adding a layer of index, the number of nodes that need to traverse a node is reduced, which means that the search efficiency is improved. Then what if we add another level of index? Will efficiency increase more?</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Similar to the way the first level index is built before, we base the first level index on the two nodes and extract a node to the second level index. Now let’s look up 16 again, we only need to traverse 6 nodes, and the number of nodes that need to be traversed is reduced.<br><img src="https://github.com/sunstady/hexoFirst/blob/master/Skip_list/3.jpg?raw=true" alt="3"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;The above example does not have a large amount of data, so even if a two-level index is added, the improvement in search efficiency is not obvious. The following figure is a linked list of 64 nodes. According to the above idea, a five-level index is established.<br><img src="https://github.com/sunstady/hexoFirst/blob/master/Skip_list/4.jpg?raw=true" alt="4"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;As can be seen from the figure, when there is no index, the search 62 needs to traverse 62 nodes. Now only need to traverse 11 nodes, the speed is much improved! Therefore, when the length n of the linked list is relatively large, such as 1000 and 10000, the efficiency of the search will be very obvious after the index is built.</p>
<h2 id="How-fast-is-the-query-with-Skip-list"><a href="#How-fast-is-the-query-with-Skip-list" class="headerlink" title="How fast is the query with Skip list?"></a>How fast is the query with Skip list?</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;The execution efficiency of the algorithm can be measured by time complexity. We know that the time complexity of querying a data in a single linked list is O(n). So in Skip list with a multi-level index, what is the time complexity of querying a certain data?</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Let’s look at such a question. If there are n nodes in the list, how many levels of index will there be?</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;According to the above, the number of nodes in the first level index is about n/2, the number of nodes in the second level index is about n/4, and the number of nodes in the third level index is about n/8. By analogy, that is, the number of nodes of the k-th index is 1/2 of the number of nodes of the k-1th index, and the number of the k-th index nodes is n / (2^k).</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Suppose the index has h levels, and the most advanced index has 2 nodes. By the above formula, n/(2^h)=2 can be obtained, thereby obtaining h=log2(n-1). If the original linked list layer is included, the height of the entire Skip list is log2n. When we query a certain data in the Skip list, if each layer has to traverse m nodes, the time complexity of querying a data in the Skip list is O(m * logn).</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;What is the value of this m? According to the previous index structure, each level of our index only needs to traverse up to 3 nodes, that is, m = 3.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Suppose the data we are looking for is x. In the k-th index, after we traverse to the y node, we find that x is greater than y and less than the subsequent z, so we drop from the k-th index through the down pointer of y. Go to the k-1 level index. In the k-1th index, there are only 3 nodes (including y and z) between y and z. Therefore, we only need to traverse 3 nodes in the k-1 level index, and so on, each level index only needs to traverse 3 nodes at most.<br><img src="https://github.com/sunstady/hexoFirst/blob/master/Skip_list/5.jpg?raw=true" alt="5"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Through the above analysis, we get m = 3. So the time complexity of querying arbitrary data in the Skip list is O(logn). The time complexity of this lookup is the same as the binary search. In other words, we actually implemented a binary search based on a single-linked list. However, the efficiency of this query is improved, provided that many levels of indexing are established.</p>
<h2 id="Is-the-Skip-list-a-waste-of-memory"><a href="#Is-the-Skip-list-a-waste-of-memory" class="headerlink" title="Is the Skip list a waste of memory?"></a>Is the Skip list a waste of memory?</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;Compared to a simple single linked list, Skip list needs to store multiple levels of index, which definitely consumes more storage space. How much extra storage does it take in the end?</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;The spatial complexity analysis of Skip list is not difficult. Assuming that the original linked list size is n, the first level index has about n/2 nodes, the second level index has about n/4 nodes, and so on. When you increase the level, you cut it by half until you have 2 nodes left. If we write the number of nodes in each layer of the index, it is an equal series.<br><img src="https://github.com/sunstady/hexoFirst/blob/master/Skip_list/6.jpg?raw=true" alt="6"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;The sum of the nodes of these levels of index iis n/2 + n/4 + n/8 + … + 8 + 4 + 2 = n-2. Therefore, the space complexity of the Skip list is O(n). That is, if we construct a single-linked list of n nodes into a Skip list, we need to use an additional storage space close to n nodes.     </p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;If we have three or five nodes, draw a node to the superior index. Although the space complexity is still O(n), the index construction method of the two nodes above is to reduce the storage space of the index node by half.<br><img src="https://github.com/sunstady/hexoFirst/blob/master/Skip_list/7.jpg?raw=true" alt="7"></p>
<h2 id="Efficient-dynamic-insertion-and-deletion"><a href="#Efficient-dynamic-insertion-and-deletion" class="headerlink" title="Efficient dynamic insertion and deletion"></a>Efficient dynamic insertion and deletion</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;We know that in a single-linked list, once the position to be inserted is located, the time complexity of inserting the node is very low. It is O(1). However, in order to ensure the order of the data in the original linked list, we need to find the location to be inserted first, this search operation will be more time consuming.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;For a purely singly linked list, you need to iterate through each node to find the location of the insertion. However, for the Skip list, we have said that the time complexity of finding a node is O(logn), so here is to find the location where a certain data should be inserted. The method is similar, and the time complexity is also O(logn).<br><img src="https://github.com/sunstady/hexoFirst/blob/master/Skip_list/8.jpg?raw=true" alt="8"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;If this node also appears in the index, in addition to deleting the nodes in the original linked list, we also delete the nodes in the index. Because the delete operation in the singly linked list needs to get the predecessor node of the deleted node, then the deletion is completed by the pointer operation. So when looking for the node to delete, be sure to get the precursor node. Of course, if we use a doubly linked list, we don’t need to consider this issue.</p>
<h2 id="Skip-list-index-update"><a href="#Skip-list-index-update" class="headerlink" title="Skip list index update"></a>Skip list index update</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;When we keep inserting data into the Skip list, if we don’t update the index, there may be a lot of data between the two index nodes. In extreme cases, Skip list will also degenerate into a singly linked list.<br><img src="https://github.com/sunstady/hexoFirst/blob/master/Skip_list/9.jpg?raw=true" alt="9"><br>&nbsp;&nbsp;&nbsp;&nbsp;As a dynamic data structure, we need some means to maintain the balance between the index and the original linked list size. That is to say, if there are more nodes in the linked list, the index nodes will be increased accordingly, avoiding complexity degradation, and performance degradation of lookup, insertion, and deletion operations.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;If you understand the balanced binary tree like red black tree and AVL tree, you know that they maintain the balance of the size of the left and right subtrees by rotating left and right, and Skip list maintains the aforementioned “balance” through random functions.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;When we insert data into the Skip list, we can choose to insert this data into the partial index layer at the same time. How to choose which index layer to join?</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;We use a random function to determine which level of index to insert this node into. If the random function generates the value k, then we will add this node to the k-level index from the first level to the kth level.<br><img src="https://github.com/sunstady/hexoFirst/blob/master/Skip_list/10.jpg?raw=true" alt="10"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;The choice of random function is very particular. From the probabilistic point of view, the index size and data size balance of Skip list can be guaranteed, and the performance is not degraded excessively.</p>
<h2 id="Java-code-for-Skip-list"><a href="#Java-code-for-Skip-list" class="headerlink" title="Java code for Skip list"></a>Java code for Skip list</h2><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SkipList</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> final <span class="keyword">int</span> MAX_LEVEL = <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> levelCount = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Node head = <span class="keyword">new</span> Node();  <span class="comment">// 带头链表</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Random r = <span class="keyword">new</span> Random();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Node <span class="title">find</span>(<span class="params"><span class="keyword">int</span> <span class="keyword">value</span></span>)</span> &#123;</span><br><span class="line">        Node p = head;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = levelCount - <span class="number">1</span>; i &gt;= <span class="number">0</span>; --i) &#123;</span><br><span class="line">            <span class="keyword">while</span> (p.forwards[i] != <span class="literal">null</span> &amp;&amp; p.forwards[i].data &lt; <span class="keyword">value</span>) &#123;</span><br><span class="line">                p = p.forwards[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (p.forwards[<span class="number">0</span>] != <span class="literal">null</span> &amp;&amp; p.forwards[<span class="number">0</span>].data == <span class="keyword">value</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> p.forwards[<span class="number">0</span>];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span>(<span class="params"><span class="keyword">int</span> <span class="keyword">value</span></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">int</span> level = randomLevel();</span><br><span class="line">        Node newNode = <span class="keyword">new</span> Node();</span><br><span class="line">        newNode.data = <span class="keyword">value</span>;</span><br><span class="line">        newNode.maxLevel = level;</span><br><span class="line">        Node update[] = <span class="keyword">new</span> Node[level];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; level; ++i) &#123;</span><br><span class="line">            update[i] = head;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// record every level largest value which smaller than insert value in update[]</span></span><br><span class="line">        Node p = head;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = level - <span class="number">1</span>; i &gt;= <span class="number">0</span>; --i) &#123;</span><br><span class="line">            <span class="keyword">while</span> (p.forwards[i] != <span class="literal">null</span> &amp;&amp; p.forwards[i].data &lt; <span class="keyword">value</span>) &#123;</span><br><span class="line">                p = p.forwards[i];</span><br><span class="line">            &#125;</span><br><span class="line">            update[i] = p;<span class="comment">// use update save node in search path</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// in search path node next node become new node forwords(next)</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; level; ++i) &#123;</span><br><span class="line">            newNode.forwards[i] = update[i].forwards[i];</span><br><span class="line">            update[i].forwards[i] = newNode;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// update node hight</span></span><br><span class="line">        <span class="keyword">if</span> (levelCount &lt; level) levelCount = level;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span>(<span class="params"><span class="keyword">int</span> <span class="keyword">value</span></span>)</span> &#123;</span><br><span class="line">        Node[] update = <span class="keyword">new</span> Node[levelCount];</span><br><span class="line">        Node p = head;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = levelCount - <span class="number">1</span>; i &gt;= <span class="number">0</span>; --i) &#123;</span><br><span class="line">            <span class="keyword">while</span> (p.forwards[i] != <span class="literal">null</span> &amp;&amp; p.forwards[i].data &lt; <span class="keyword">value</span>) &#123;</span><br><span class="line">                p = p.forwards[i];</span><br><span class="line">            &#125;</span><br><span class="line">            update[i] = p;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (p.forwards[<span class="number">0</span>] != <span class="literal">null</span> &amp;&amp; p.forwards[<span class="number">0</span>].data == <span class="keyword">value</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = levelCount - <span class="number">1</span>; i &gt;= <span class="number">0</span>; --i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (update[i].forwards[i] != <span class="literal">null</span> &amp;&amp; update[i].forwards[i].data == <span class="keyword">value</span>) &#123;</span><br><span class="line">                    update[i].forwards[i] = update[i].forwards[i].forwards[i];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 随机 level 次，如果是奇数层数 +1，防止伪随机</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">randomLevel</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">int</span> level = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; MAX_LEVEL; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (r.nextInt() % <span class="number">2</span> == <span class="number">1</span>) &#123;</span><br><span class="line">                level++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> level;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printAll</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        Node p = head;</span><br><span class="line">        <span class="keyword">while</span> (p.forwards[<span class="number">0</span>] != <span class="literal">null</span>) &#123;</span><br><span class="line">            System.<span class="keyword">out</span>.print(p.forwards[<span class="number">0</span>] + <span class="string">" "</span>);</span><br><span class="line">            p = p.forwards[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        System.<span class="keyword">out</span>.println();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Node</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> data = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">private</span> Node forwards[] = <span class="keyword">new</span> Node[MAX_LEVEL];</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> maxLevel = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">            StringBuilder builder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">            builder.append(<span class="string">"&#123; data: "</span>);</span><br><span class="line">            builder.append(data);</span><br><span class="line">            builder.append(<span class="string">"; levels: "</span>);</span><br><span class="line">            builder.append(maxLevel);</span><br><span class="line">            builder.append(<span class="string">" &#125;"</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> builder.toString();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.sunstady.xyz/2018/12/25/Skip-list/" data-id="cjq2k46li00049hprv0n2d46j" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Algorithms/">Algorithms</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2018/12/23/分析第一个Android程序/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">分析第一个Android程序</div>
    </a>
  
</nav>

  
</article>



</section>
        
          <aside id="sidebar">
  
    <div class="widget-wrap">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <h1 class="blog-title">Sanstyle</h1>
    <h2 class="blog-subtitle"></h2>
    <ul class="blog-link">
     
          <a href="/" title="Home">
            <li>主页</li>
          </a>
        
          <a href="/archives" title="Archives">
            <li>归档</li>
          </a>
        
          <a href="/categories" title="Categories">
            <li>分类</li>
          </a>
        
          <a href="/tags" title="Tags">
            <li>标签</li>
          </a>
        
          <a href="/about" title="关于">
            <li>关于</li>
          </a>
        
    </ul>
  </div>
</div>

  
    <div class="widget-wrap">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <img class="avatar" src="https://github.com/sunstady/hexo/blob/master/images/2017.jpg?raw=true">
    <h2 class="author">时三</h2>
    <h3 class="description">我善良,并不代表我不邪恶.</h3>
    <div class="count-box">
      <a href="/archives"><div><strong>3</strong><br>文章</div></a>
      <a href="/categories"><div><strong>2</strong><br>分类</div></a>
      <a href="/tags"><div><strong>2</strong><br>标签</div></a>
    </div>



    <div class="social-link">
      
        <a class="hvr-bounce-in" href="http://github.com/sunstady" target="_blank" title="Github">
          Github
        </a>
      
    </div>

    <div class="friend-link">
      <h2>友情链接</h2>
      
        <a class="hvr-bounce-in" href="http://sanstylemc.cn/" target="_blank" title="Sanstyle">
          Sanstyle
        </a>
      
    </div>
  </div>
</div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy;2017 - 2018 时三<br>
      由<a href="http://hexo.io/" target="_blank">Hexo</a>强力驱动 | 
      主题-<a href="https://github.com/ShanaMaid/hexo-theme-shana">Shana</a>
      
    </div>
    
  </div>
</footer>
    </div>
    

<script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="//apps.bdimg.com/libs/wow/0.1.6/wow.min.js"></script>
<script>
new WOW().init();
</script>   


  <link rel="stylesheet" href="/plugin/fancybox/jquery.fancybox.css">
  <script src="/plugin/fancybox/jquery.fancybox.pack.js"></script>



  <link rel="stylesheet" href="/plugin/galmenu/GalMenu.css">
  <script src="/plugin/galmenu/GalMenu.js"></script>
  <div class="GalMenu GalDropDown">
      <div class="circle" id="gal">
        <div class="ring">
          
            <a href="/" title="" class="menuItem">首页</a>
          
            <a href="/tags" title="" class="menuItem">标签</a>
          
            <a href="/categories" title="" class="menuItem">分类</a>
          
            <a href="/archives" title="" class="menuItem">归档</a>
          
            <a href="/schedule" title="" class="menuItem">日程表</a>
          
            <a href="/xxxxxxx" title="" class="menuItem">搜索</a>
          
        </div>
        
          <audio id="audio" src="#"></audio>
        
      </div> 
</div>
<div id="overlay" style="opacity: 1; cursor: pointer;"></div>
  <script type="text/javascript">var items = document.querySelectorAll('.menuItem');
    for (var i = 0,
    l = items.length; i < l; i++) {
      items[i].style.left = (50 - 35 * Math.cos( - 0.5 * Math.PI - 2 * (1 / l) * i * Math.PI)).toFixed(4) + "%";
      items[i].style.top = (50 + 35 * Math.sin( - 0.5 * Math.PI - 2 * (1 / l) * i * Math.PI)).toFixed(4) + "%"
    }</script>
<script type="text/javascript">
  $(document).ready(function() {
    $('body').GalMenu({
      'menu': 'GalDropDown'
    })
  });
</script>

  <section class="hidden-xs"> 
  <ul class="cb-slideshow"> 
    <li><span>苟利</span></li> 
    <li><span>国家</span></li> 
    <li><span>生死以</span></li> 
    <li><span>岂能</span></li> 
    <li><span>祸福</span></li> 
    <li><span>趋避之</span></li> 
  </ul>
</section>
<script src="/js/script.js"></script>




  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("i7jzN6yAlCyc52D54nDFzeXb-gzGzoHsz", "JKAIt4j5SoPJyHMx4IphgTdI");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.article-title').length > 1) {
        showTime(Counter);
      }
    });
  </script>





  </div>
</body>
</html>